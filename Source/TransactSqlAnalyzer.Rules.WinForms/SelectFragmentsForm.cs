using Microsoft.SqlServer.TransactSql.ScriptDom;
using System;
using System.Linq;
using System.Windows.Forms;
using TransactSqlAnalyzer.Rules.Common.Utils;

namespace TransactSqlAnalyzer.Rules.WinForms
{
    public partial class SelectFragmentsForm : Form
    {
        private SqlFragmentTypeList fragmentTypes;
        /*
        private SqlFragmentTypeList fragmentTypes = new SqlFragmentTypeList {
            typeof(AddAlterFullTextIndexAction),
            typeof(AddFileSpec),
            typeof(AddMemberAlterRoleAction),
            typeof(AddSearchPropertyListAction),
            typeof(AddSignatureStatement),
            typeof(AdHocDataSource),
            typeof(AdHocTableReference),
            typeof(AlgorithmKeyOption),
            typeof(AlterApplicationRoleStatement),
            typeof(AlterAssemblyStatement),
            typeof(AlterAsymmetricKeyStatement),
            typeof(AlterAuthorizationStatement),
            typeof(AlterAvailabilityGroupAction),
            typeof(AlterAvailabilityGroupFailoverAction),
            typeof(AlterAvailabilityGroupFailoverOption),
            typeof(AlterAvailabilityGroupStatement),
            typeof(AlterBrokerPriorityStatement),
            typeof(AlterCertificateStatement),
            typeof(AlterColumnAlterFullTextIndexAction),
            typeof(AlterColumnEncryptionKeyStatement),
            typeof(AlterCreateEndpointStatementBase),
            typeof(AlterCreateServiceStatementBase),
            typeof(AlterCredentialStatement),
            typeof(AlterCryptographicProviderStatement),
            typeof(AlterDatabaseAddFileGroupStatement),
            typeof(AlterDatabaseAddFileStatement),
            typeof(AlterDatabaseAuditSpecificationStatement),
            typeof(AlterDatabaseCollateStatement),
            typeof(AlterDatabaseEncryptionKeyStatement),
            typeof(AlterDatabaseModifyFileGroupStatement),
            typeof(AlterDatabaseModifyFileStatement),
            typeof(AlterDatabaseModifyNameStatement),
            typeof(AlterDatabaseRebuildLogStatement),
            typeof(AlterDatabaseRemoveFileGroupStatement),
            typeof(AlterDatabaseRemoveFileStatement),
            typeof(AlterDatabaseScopedConfigurationClearStatement),
            typeof(AlterDatabaseScopedConfigurationSetStatement),
            typeof(AlterDatabaseScopedConfigurationStatement),
            typeof(AlterDatabaseSetStatement),
            typeof(AlterDatabaseStatement),
            typeof(AlterDatabaseTermination),
            typeof(AlterEndpointStatement),
            typeof(AlterEventSessionStatement),
            typeof(AlterExternalDataSourceStatement),
            typeof(AlterExternalResourcePoolStatement),
            typeof(AlterFederationStatement),
            typeof(AlterFullTextCatalogStatement),
            typeof(AlterFullTextIndexAction),
            typeof(AlterFullTextIndexStatement),
            typeof(AlterFullTextStopListStatement),
            typeof(AlterFunctionStatement),
            typeof(AlterIndexStatement),
            typeof(AlterLoginAddDropCredentialStatement),
            typeof(AlterLoginEnableDisableStatement),
            typeof(AlterLoginOptionsStatement),
            typeof(AlterLoginStatement),
            typeof(AlterMasterKeyStatement),
            typeof(AlterMessageTypeStatement),
            typeof(AlterPartitionFunctionStatement),
            typeof(AlterPartitionSchemeStatement),
            typeof(AlterProcedureStatement),
            typeof(AlterQueueStatement),
            typeof(AlterRemoteServiceBindingStatement),
            typeof(AlterResourceGovernorStatement),
            typeof(AlterResourcePoolStatement),
            typeof(AlterRoleAction),
            typeof(AlterRoleStatement),
            typeof(AlterRouteStatement),
            typeof(AlterSchemaStatement),
            typeof(AlterSearchPropertyListStatement),
            typeof(AlterSecurityPolicyStatement),
            typeof(AlterSequenceStatement),
            typeof(AlterServerAuditSpecificationStatement),
            typeof(AlterServerAuditStatement),
            typeof(AlterServerConfigurationBufferPoolExtensionContainerOption),
            typeof(AlterServerConfigurationBufferPoolExtensionOption),
            typeof(AlterServerConfigurationBufferPoolExtensionSizeOption),
            typeof(AlterServerConfigurationDiagnosticsLogMaxSizeOption),
            typeof(AlterServerConfigurationDiagnosticsLogOption),
            typeof(AlterServerConfigurationFailoverClusterPropertyOption),
            typeof(AlterServerConfigurationHadrClusterOption),
            typeof(AlterServerConfigurationSetBufferPoolExtensionStatement),
            typeof(AlterServerConfigurationSetDiagnosticsLogStatement),
            typeof(AlterServerConfigurationSetFailoverClusterPropertyStatement),
            typeof(AlterServerConfigurationSetHadrClusterStatement),
            typeof(AlterServerConfigurationSetSoftNumaStatement),
            typeof(AlterServerConfigurationSoftNumaOption),
            typeof(AlterServerConfigurationStatement),
            typeof(AlterServerRoleStatement),
            typeof(AlterServiceMasterKeyStatement),
            typeof(AlterServiceStatement),
            typeof(AlterSymmetricKeyStatement),
            typeof(AlterTableAddTableElementStatement),
            typeof(AlterTableAlterColumnStatement),
            typeof(AlterTableAlterIndexStatement),
            typeof(AlterTableChangeTrackingModificationStatement),
            typeof(AlterTableConstraintModificationStatement),
            typeof(AlterTableDropTableElement),
            typeof(AlterTableDropTableElementStatement),
            typeof(AlterTableFileTableNamespaceStatement),
            typeof(AlterTableRebuildStatement),
            typeof(AlterTableSetStatement),
            typeof(AlterTableStatement),
            typeof(AlterTableSwitchStatement),
            typeof(AlterTableTriggerModificationStatement),
            typeof(AlterTriggerStatement),
            typeof(AlterUserStatement),
            typeof(AlterViewStatement),
            typeof(AlterWorkloadGroupStatement),
            typeof(AlterXmlSchemaCollectionStatement),
            typeof(ApplicationRoleOption),
            typeof(ApplicationRoleStatement),
            typeof(AssemblyEncryptionSource),
            typeof(AssemblyName),
            typeof(AssemblyOption),
            typeof(AssemblyStatement),
            typeof(AssignmentSetClause),
            typeof(AsymmetricKeyCreateLoginSource),
            typeof(AtomicBlockOption),
            typeof(AtTimeZoneCall),
            typeof(AuditActionGroupReference),
            typeof(AuditActionSpecification),
            typeof(AuditGuidAuditOption),
            typeof(AuditOption),
            typeof(AuditSpecificationDetail),
            typeof(AuditSpecificationPart),
            typeof(AuditSpecificationStatement),
            typeof(AuditTarget),
            typeof(AuditTargetOption),
            typeof(AuthenticationEndpointProtocolOption),
            typeof(AuthenticationPayloadOption),
            typeof(AutoCleanupChangeTrackingOptionDetail),
            typeof(AutoCreateStatisticsDatabaseOption),
            typeof(AvailabilityGroupOption),
            typeof(AvailabilityGroupStatement),
            typeof(AvailabilityModeReplicaOption),
            typeof(AvailabilityReplica),
            typeof(AvailabilityReplicaOption),
            typeof(BackupCertificateStatement),
            typeof(BackupDatabaseStatement),
            typeof(BackupEncryptionOption),
            typeof(BackupMasterKeyStatement),
            typeof(BackupOption),
            typeof(BackupRestoreFileInfo),
            typeof(BackupRestoreMasterKeyStatementBase),
            typeof(BackupServiceMasterKeyStatement),
            typeof(BackupStatement),
            typeof(BackupTransactionLogStatement),
            typeof(BackwardsCompatibleDropIndexClause),
            typeof(BeginConversationTimerStatement),
            typeof(BeginDialogStatement),
            typeof(BeginEndAtomicBlockStatement),
            typeof(BeginEndBlockStatement),
            typeof(BeginTransactionStatement),
            typeof(BinaryExpression),
            typeof(BinaryLiteral),
            typeof(BinaryQueryExpression),
            typeof(BooleanBinaryExpression),
            typeof(BooleanComparisonExpression),
            typeof(BooleanExpression),
            typeof(BooleanExpressionSnippet),
            typeof(BooleanIsNullExpression),
            typeof(BooleanNotExpression),
            typeof(BooleanParenthesisExpression),
            typeof(BooleanTernaryExpression),
            typeof(BoundingBoxParameter),
            typeof(BoundingBoxSpatialIndexOption),
            typeof(BreakStatement),
            typeof(BrokerPriorityParameter),
            typeof(BrokerPriorityStatement),
            typeof(BrowseForClause),
            typeof(BuiltInFunctionTableReference),
            typeof(BulkInsertBase),
            typeof(BulkInsertOption),
            typeof(BulkInsertStatement),
            typeof(BulkOpenRowset),
            typeof(CallTarget),
            typeof(CaseExpression),
            typeof(CastCall),
            typeof(CellsPerObjectSpatialIndexOption),
            typeof(CertificateCreateLoginSource),
            typeof(CertificateOption),
            typeof(CertificateStatementBase),
            typeof(ChangeRetentionChangeTrackingOptionDetail),
            typeof(ChangeTableChangesTableReference),
            typeof(ChangeTableVersionTableReference),
            typeof(ChangeTrackingDatabaseOption),
            typeof(ChangeTrackingFullTextIndexOption),
            typeof(ChangeTrackingOptionDetail),
            typeof(CharacterSetPayloadOption),
            typeof(CheckConstraintDefinition),
            typeof(CheckpointStatement),
            typeof(ChildObjectName),
            typeof(CloseCursorStatement),
            typeof(CloseMasterKeyStatement),
            typeof(CloseSymmetricKeyStatement),
            typeof(CoalesceExpression),
            typeof(ColumnDefinition),
            typeof(ColumnDefinitionBase),
            typeof(ColumnEncryptionAlgorithmNameParameter),
            typeof(ColumnEncryptionAlgorithmParameter),
            typeof(ColumnEncryptionDefinition),
            typeof(ColumnEncryptionDefinitionParameter),
            typeof(ColumnEncryptionKeyNameParameter),
            typeof(ColumnEncryptionKeyStatement),
            typeof(ColumnEncryptionKeyValue),
            typeof(ColumnEncryptionKeyValueParameter),
            typeof(ColumnEncryptionTypeParameter),
            typeof(ColumnMasterKeyNameParameter),
            typeof(ColumnMasterKeyParameter),
            typeof(ColumnMasterKeyPathParameter),
            typeof(ColumnMasterKeyStoreProviderNameParameter),
            typeof(ColumnReferenceExpression),
            typeof(ColumnStorageOptions),
            typeof(ColumnWithSortOrder),
            typeof(CommandSecurityElement80),
            typeof(CommitTransactionStatement),
            typeof(CommonTableExpression),
            typeof(CompositeGroupingSpecification),
            typeof(CompressionDelayIndexOption),
            typeof(CompressionEndpointProtocolOption),
            typeof(CompressionPartitionRange),
            typeof(ComputeClause),
            typeof(ComputeFunction),
            typeof(ConstraintDefinition),
            typeof(ContainmentDatabaseOption),
            typeof(ContinueStatement),
            typeof(ContractMessage),
            typeof(ConvertCall),
            typeof(CreateAggregateStatement),
            typeof(CreateApplicationRoleStatement),
            typeof(CreateAssemblyStatement),
            typeof(CreateAsymmetricKeyStatement),
            typeof(CreateAvailabilityGroupStatement),
            typeof(CreateBrokerPriorityStatement),
            typeof(CreateCertificateStatement),
            typeof(CreateColumnEncryptionKeyStatement),
            typeof(CreateColumnMasterKeyStatement),
            typeof(CreateColumnStoreIndexStatement),
            typeof(CreateContractStatement),
            typeof(CreateCredentialStatement),
            typeof(CreateCryptographicProviderStatement),
            typeof(CreateDatabaseAuditSpecificationStatement),
            typeof(CreateDatabaseEncryptionKeyStatement),
            typeof(CreateDatabaseStatement),
            typeof(CreateDefaultStatement),
            typeof(CreateEndpointStatement),
            typeof(CreateEventNotificationStatement),
            typeof(CreateEventSessionStatement),
            typeof(CreateExternalDataSourceStatement),
            typeof(CreateExternalFileFormatStatement),
            typeof(CreateExternalResourcePoolStatement),
            typeof(CreateExternalTableStatement),
            typeof(CreateFederationStatement),
            typeof(CreateFullTextCatalogStatement),
            typeof(CreateFullTextIndexStatement),
            typeof(CreateFullTextStopListStatement),
            typeof(CreateFunctionStatement),
            typeof(CreateIndexStatement),
            typeof(CreateLoginSource),
            typeof(CreateLoginStatement),
            typeof(CreateMasterKeyStatement),
            typeof(CreateMessageTypeStatement),
            typeof(CreatePartitionFunctionStatement),
            typeof(CreatePartitionSchemeStatement),
            typeof(CreateProcedureStatement),
            typeof(CreateQueueStatement),
            typeof(CreateRemoteServiceBindingStatement),
            typeof(CreateResourcePoolStatement),
            typeof(CreateRoleStatement),
            typeof(CreateRouteStatement),
            typeof(CreateRuleStatement),
            typeof(CreateSchemaStatement),
            typeof(CreateSearchPropertyListStatement),
            typeof(CreateSecurityPolicyStatement),
            typeof(CreateSelectiveXmlIndexStatement),
            typeof(CreateSequenceStatement),
            typeof(CreateServerAuditSpecificationStatement),
            typeof(CreateServerAuditStatement),
            typeof(CreateServerRoleStatement),
            typeof(CreateServiceStatement),
            typeof(CreateSpatialIndexStatement),
            typeof(CreateStatisticsStatement),
            typeof(CreateSymmetricKeyStatement),
            typeof(CreateSynonymStatement),
            typeof(CreateTableStatement),
            typeof(CreateTriggerStatement),
            typeof(CreateTypeStatement),
            typeof(CreateTypeTableStatement),
            typeof(CreateTypeUddtStatement),
            typeof(CreateTypeUdtStatement),
            typeof(CreateUserStatement),
            typeof(CreateViewStatement),
            typeof(CreateWorkloadGroupStatement),
            typeof(CreateXmlIndexStatement),
            typeof(CreateXmlSchemaCollectionStatement),
            typeof(CreationDispositionKeyOption),
            typeof(CredentialStatement),
            typeof(CryptoMechanism),
            typeof(CubeGroupingSpecification),
            typeof(CursorDefaultDatabaseOption),
            typeof(CursorDefinition),
            typeof(CursorId),
            typeof(CursorOption),
            typeof(CursorStatement),
            typeof(DatabaseAuditAction),
            typeof(DatabaseConfigurationClearOption),
            typeof(DatabaseConfigurationSetOption),
            typeof(DatabaseEncryptionKeyStatement),
            typeof(DatabaseOption),
            typeof(DataCompressionOption),
            typeof(DataModificationSpecification),
            typeof(DataModificationStatement),
            typeof(DataModificationTableReference),
            typeof(DataTypeReference),
            typeof(DataTypeSequenceOption),
            typeof(DbccNamedLiteral),
            typeof(DbccOption),
            typeof(DbccStatement),
            typeof(DeallocateCursorStatement),
            typeof(DeclareCursorStatement),
            typeof(DeclareTableVariableBody),
            typeof(DeclareTableVariableStatement),
            typeof(DeclareVariableElement),
            typeof(DeclareVariableStatement),
            typeof(DefaultConstraintDefinition),
            typeof(DefaultLiteral),
            typeof(DelayedDurabilityDatabaseOption),
            typeof(DeleteMergeAction),
            typeof(DeleteSpecification),
            typeof(DeleteStatement),
            typeof(DenyStatement),
            typeof(DenyStatement80),
            typeof(DeviceInfo),
            typeof(DialogOption),
            typeof(DiskStatement),
            typeof(DiskStatementOption),
            typeof(DropAggregateStatement),
            typeof(DropAlterFullTextIndexAction),
            typeof(DropApplicationRoleStatement),
            typeof(DropAssemblyStatement),
            typeof(DropAsymmetricKeyStatement),
            typeof(DropAvailabilityGroupStatement),
            typeof(DropBrokerPriorityStatement),
            typeof(DropCertificateStatement),
            typeof(DropChildObjectsStatement),
            typeof(DropClusteredConstraintMoveOption),
            typeof(DropClusteredConstraintOption),
            typeof(DropClusteredConstraintStateOption),
            typeof(DropClusteredConstraintValueOption),
            typeof(DropColumnEncryptionKeyStatement),
            typeof(DropColumnMasterKeyStatement),
            typeof(DropContractStatement),
            typeof(DropCredentialStatement),
            typeof(DropCryptographicProviderStatement),
            typeof(DropDatabaseAuditSpecificationStatement),
            typeof(DropDatabaseEncryptionKeyStatement),
            typeof(DropDatabaseStatement),
            typeof(DropDefaultStatement),
            typeof(DropEndpointStatement),
            typeof(DropEventNotificationStatement),
            typeof(DropEventSessionStatement),
            typeof(DropExternalDataSourceStatement),
            typeof(DropExternalFileFormatStatement),
            typeof(DropExternalResourcePoolStatement),
            typeof(DropExternalTableStatement),
            typeof(DropFederationStatement),
            typeof(DropFullTextCatalogStatement),
            typeof(DropFullTextIndexStatement),
            typeof(DropFullTextStopListStatement),
            typeof(DropFunctionStatement),
            typeof(DropIndexClause),
            typeof(DropIndexClauseBase),
            typeof(DropIndexStatement),
            typeof(DropLoginStatement),
            typeof(DropMasterKeyStatement),
            typeof(DropMemberAlterRoleAction),
            typeof(DropMessageTypeStatement),
            typeof(DropObjectsStatement),
            typeof(DropPartitionFunctionStatement),
            typeof(DropPartitionSchemeStatement),
            typeof(DropProcedureStatement),
            typeof(DropQueueStatement),
            typeof(DropRemoteServiceBindingStatement),
            typeof(DropResourcePoolStatement),
            typeof(DropRoleStatement),
            typeof(DropRouteStatement),
            typeof(DropRuleStatement),
            typeof(DropSchemaStatement),
            typeof(DropSearchPropertyListAction),
            typeof(DropSearchPropertyListStatement),
            typeof(DropSecurityPolicyStatement),
            typeof(DropSequenceStatement),
            typeof(DropServerAuditSpecificationStatement),
            typeof(DropServerAuditStatement),
            typeof(DropServerRoleStatement),
            typeof(DropServiceStatement),
            typeof(DropSignatureStatement),
            typeof(DropStatisticsStatement),
            typeof(DropSymmetricKeyStatement),
            typeof(DropSynonymStatement),
            typeof(DropTableStatement),
            typeof(DropTriggerStatement),
            typeof(DropTypeStatement),
            typeof(DropUnownedObjectStatement),
            typeof(DropUserStatement),
            typeof(DropViewStatement),
            typeof(DropWorkloadGroupStatement),
            typeof(DropXmlSchemaCollectionStatement),
            typeof(DurabilityTableOption),
            typeof(EnabledDisabledPayloadOption),
            typeof(EnableDisableTriggerStatement),
            typeof(EncryptedValueParameter),
            typeof(EncryptionPayloadOption),
            typeof(EncryptionSource),
            typeof(EndConversationStatement),
            typeof(EndpointAffinity),
            typeof(EndpointProtocolOption),
            typeof(EventDeclaration),
            typeof(EventDeclarationCompareFunctionParameter),
            typeof(EventDeclarationSetParameter),
            typeof(EventGroupContainer),
            typeof(EventNotificationObjectScope),
            typeof(EventRetentionSessionOption),
            typeof(EventSessionObjectName),
            typeof(EventSessionStatement),
            typeof(EventTypeContainer),
            typeof(EventTypeGroupContainer),
            typeof(ExecutableEntity),
            typeof(ExecutableProcedureReference),
            typeof(ExecutableStringList),
            typeof(ExecuteAsClause),
            typeof(ExecuteAsFunctionOption),
            typeof(ExecuteAsProcedureOption),
            typeof(ExecuteAsStatement),
            typeof(ExecuteAsTriggerOption),
            typeof(ExecuteContext),
            typeof(ExecuteInsertSource),
            typeof(ExecuteOption),
            typeof(ExecuteParameter),
            typeof(ExecuteSpecification),
            typeof(ExecuteStatement),
            typeof(ExistsPredicate),
            typeof(ExpressionCallTarget),
            typeof(ExpressionGroupingSpecification),
            typeof(ExpressionWithSortOrder),
            typeof(ExternalDataSourceLiteralOrIdentifierOption),
            typeof(ExternalDataSourceOption),
            typeof(ExternalDataSourceStatement),
            typeof(ExternalFileFormatContainerOption),
            typeof(ExternalFileFormatLiteralOption),
            typeof(ExternalFileFormatOption),
            typeof(ExternalFileFormatStatement),
            typeof(ExternalFileFormatUseDefaultTypeOption),
            typeof(ExternalResourcePoolAffinitySpecification),
            typeof(ExternalResourcePoolParameter),
            typeof(ExternalResourcePoolStatement),
            typeof(ExternalTableColumnDefinition),
            typeof(ExternalTableDistributionOption),
            typeof(ExternalTableDistributionPolicy),
            typeof(ExternalTableLiteralOrIdentifierOption),
            typeof(ExternalTableOption),
            typeof(ExternalTableRejectTypeOption),
            typeof(ExternalTableReplicatedDistributionPolicy),
            typeof(ExternalTableRoundRobinDistributionPolicy),
            typeof(ExternalTableShardedDistributionPolicy),
            typeof(ExternalTableStatement),
            typeof(ExtractFromExpression),
            typeof(FailoverModeReplicaOption),
            typeof(FederationScheme),
            typeof(FetchCursorStatement),
            typeof(FetchType),
            typeof(FileDeclaration),
            typeof(FileDeclarationOption),
            typeof(FileEncryptionSource),
            typeof(FileGroupDefinition),
            typeof(FileGroupOrPartitionScheme),
            typeof(FileGrowthFileDeclarationOption),
            typeof(FileNameFileDeclarationOption),
            typeof(FileStreamDatabaseOption),
            typeof(FileStreamOnDropIndexOption),
            typeof(FileStreamOnTableOption),
            typeof(FileStreamRestoreOption),
            typeof(FileTableCollateFileNameTableOption),
            typeof(FileTableConstraintNameTableOption),
            typeof(FileTableDirectoryTableOption),
            typeof(ForceSeekTableHint),
            typeof(ForClause),
            typeof(ForeignKeyConstraintDefinition),
            typeof(FromClause),
            typeof(FullTextCatalogAndFileGroup),
            typeof(FullTextCatalogOption),
            typeof(FullTextCatalogStatement),
            typeof(FullTextIndexColumn),
            typeof(FullTextIndexOption),
            typeof(FullTextPredicate),
            typeof(FullTextStopListAction),
            typeof(FullTextTableReference),
            typeof(FunctionCall),
            typeof(FunctionCallSetClause),
            typeof(FunctionOption),
            typeof(FunctionReturnType),
            typeof(FunctionStatementBody),
            typeof(GeneralSetCommand),
            typeof(GetConversationGroupStatement),
            typeof(GlobalVariableExpression),
            typeof(GoToStatement),
            typeof(GrandTotalGroupingSpecification),
            typeof(GrantStatement),
            typeof(GrantStatement80),
            typeof(GridParameter),
            typeof(GridsSpatialIndexOption),
            typeof(GroupByClause),
            typeof(GroupingSetsGroupingSpecification),
            typeof(GroupingSpecification),
            typeof(HadrAvailabilityGroupDatabaseOption),
            typeof(HadrDatabaseOption),
            typeof(HavingClause),
            typeof(Identifier),
            typeof(IdentifierAtomicBlockOption),
            typeof(IdentifierDatabaseOption),
            typeof(IdentifierLiteral),
            typeof(IdentifierOrValueExpression),
            typeof(IdentifierPrincipalOption),
            typeof(IdentifierSnippet),
            typeof(IdentityFunctionCall),
            typeof(IdentityOptions),
            typeof(IdentityValueKeyOption),
            typeof(IfStatement),
            typeof(IIfCall),
            typeof(IndexDefinition),
            typeof(IndexExpressionOption),
            typeof(IndexOption),
            typeof(IndexStatement),
            typeof(IndexStateOption),
            typeof(IndexTableHint),
            typeof(IndexType),
            typeof(InlineDerivedTable),
            typeof(InlineResultSetDefinition),
            typeof(InPredicate),
            typeof(InsertBulkColumnDefinition),
            typeof(InsertBulkStatement),
            typeof(InsertMergeAction),
            typeof(InsertSource),
            typeof(InsertSpecification),
            typeof(InsertStatement),
            typeof(IntegerLiteral),
            typeof(InternalOpenRowset),
            typeof(IPv4),
            typeof(JoinParenthesisTableReference),
            typeof(JoinTableReference),
            typeof(JsonForClause),
            typeof(JsonForClauseOption),
            typeof(KeyOption),
            typeof(KeySourceKeyOption),
            typeof(KillQueryNotificationSubscriptionStatement),
            typeof(KillStatement),
            typeof(KillStatsJobStatement),
            typeof(LabelStatement),
            typeof(LeftFunctionCall),
            typeof(LikePredicate),
            typeof(LineNoStatement),
            typeof(ListenerIPEndpointProtocolOption),
            typeof(Literal),
            typeof(LiteralAtomicBlockOption),
            typeof(LiteralAuditTargetOption),
            typeof(LiteralAvailabilityGroupOption),
            typeof(LiteralBulkInsertOption),
            typeof(LiteralDatabaseOption),
            typeof(LiteralEndpointProtocolOption),
            typeof(LiteralOptimizerHint),
            typeof(LiteralOptionValue),
            typeof(LiteralPayloadOption),
            typeof(LiteralPrincipalOption),
            typeof(LiteralRange),
            typeof(LiteralReplicaOption),
            typeof(LiteralSessionOption),
            typeof(LiteralStatisticsOption),
            typeof(LiteralTableHint),
            typeof(LockEscalationTableOption),
            typeof(LoginTypePayloadOption),
            typeof(LowPriorityLockWaitAbortAfterWaitOption),
            typeof(LowPriorityLockWaitMaxDurationOption),
            typeof(LowPriorityLockWaitOption),
            typeof(LowPriorityLockWaitTableSwitchOption),
            typeof(MasterKeyStatement),
            typeof(MaxDispatchLatencySessionOption),
            typeof(MaxDopConfigurationOption),
            typeof(MaxLiteral),
            typeof(MaxRolloverFilesAuditTargetOption),
            typeof(MaxSizeAuditTargetOption),
            typeof(MaxSizeDatabaseOption),
            typeof(MaxSizeFileDeclarationOption),
            typeof(MemoryOptimizedTableOption),
            typeof(MemoryPartitionSessionOption),
            typeof(Microsoft.SqlServer.TransactSql.ScriptDom.MergeAction),
            typeof(MergeActionClause),
            typeof(MergeSpecification),
            typeof(MergeStatement),
            typeof(MessageTypeStatementBase),
            typeof(MethodSpecifier),
            typeof(MirrorToClause),
            typeof(MoneyLiteral),
            typeof(MoveConversationStatement),
            typeof(MoveRestoreOption),
            typeof(MoveToDropIndexOption),
            typeof(MultiPartIdentifier),
            typeof(MultiPartIdentifierCallTarget),
            typeof(NamedTableReference),
            typeof(NameFileDeclarationOption),
            typeof(NextValueForExpression),
            typeof(NullableConstraintDefinition),
            typeof(NullIfExpression),
            typeof(NullLiteral),
            typeof(NumericLiteral),
            typeof(OdbcConvertSpecification),
            typeof(OdbcFunctionCall),
            typeof(OdbcLiteral),
            typeof(OdbcQualifiedJoinTableReference),
            typeof(OffsetClause),
            typeof(OnFailureAuditOption),
            typeof(OnlineIndexLowPriorityLockWaitOption),
            typeof(OnlineIndexOption),
            typeof(OnOffAssemblyOption),
            typeof(OnOffAtomicBlockOption),
            typeof(OnOffAuditTargetOption),
            typeof(OnOffDatabaseOption),
            typeof(OnOffDialogOption),
            typeof(OnOffFullTextCatalogOption),
            typeof(OnOffOptionValue),
            typeof(OnOffPrimaryConfigurationOption),
            typeof(OnOffPrincipalOption),
            typeof(OnOffRemoteServiceBindingOption),
            typeof(OnOffSessionOption),
            typeof(OnOffStatisticsOption),
            typeof(OpenCursorStatement),
            typeof(OpenJsonTableReference),
            typeof(OpenMasterKeyStatement),
            typeof(OpenQueryTableReference),
            typeof(OpenRowsetTableReference),
            typeof(OpenSymmetricKeyStatement),
            typeof(OpenXmlTableReference),
            typeof(OptimizeForOptimizerHint),
            typeof(OptimizerHint),
            typeof(OptionValue),
            typeof(OrderBulkInsertOption),
            typeof(OrderByClause),
            typeof(OrderIndexOption),
            typeof(OutputClause),
            typeof(OutputIntoClause),
            typeof(OverClause),
            typeof(PageVerifyDatabaseOption),
            typeof(ParameterizationDatabaseOption),
            typeof(ParameterizedDataTypeReference),
            typeof(ParameterlessCall),
            typeof(ParenthesisExpression),
            typeof(ParseCall),
            typeof(PartitionFunctionCall),
            typeof(PartitionParameterType),
            typeof(PartitionSpecifier),
            typeof(PartnerDatabaseOption),
            typeof(PasswordAlterPrincipalOption),
            typeof(PasswordCreateLoginSource),
            typeof(PayloadOption),
            typeof(Permission),
            typeof(PermissionSetAssemblyOption),
            typeof(PivotedTableReference),
            typeof(PortsEndpointProtocolOption),
            typeof(PredicateSetStatement),
            typeof(PrimaryExpression),
            typeof(PrimaryRoleReplicaOption),
            typeof(PrincipalOption),
            typeof(PrintStatement),
            typeof(Privilege80),
            typeof(PrivilegeSecurityElement80),
            typeof(ProcedureOption),
            typeof(ProcedureParameter),
            typeof(ProcedureReference),
            typeof(ProcedureReferenceName),
            typeof(ProcedureStatementBody),
            typeof(ProcedureStatementBodyBase),
            typeof(ProcessAffinityRange),
            typeof(ProviderEncryptionSource),
            typeof(ProviderKeyNameKeyOption),
            typeof(QualifiedJoin),
            typeof(QueryDerivedTable),
            typeof(QueryExpression),
            typeof(QueryParenthesisExpression),
            typeof(QuerySpecification),
            typeof(QueryStoreCapturePolicyOption),
            typeof(QueryStoreDatabaseOption),
            typeof(QueryStoreDataFlushIntervalOption),
            typeof(QueryStoreDesiredStateOption),
            typeof(QueryStoreIntervalLengthOption),
            typeof(QueryStoreMaxPlansPerQueryOption),
            typeof(QueryStoreMaxStorageSizeOption),
            typeof(QueryStoreOption),
            typeof(QueryStoreSizeCleanupPolicyOption),
            typeof(QueryStoreTimeCleanupPolicyOption),
            typeof(QueueDelayAuditOption),
            typeof(QueueExecuteAsOption),
            typeof(QueueOption),
            typeof(QueueProcedureOption),
            typeof(QueueStatement),
            typeof(QueueStateOption),
            typeof(QueueValueOption),
            typeof(RaiseErrorLegacyStatement),
            typeof(RaiseErrorStatement),
            typeof(ReadOnlyForClause),
            typeof(ReadTextStatement),
            typeof(RealLiteral),
            typeof(ReceiveStatement),
            typeof(ReconfigureStatement),
            typeof(RecoveryDatabaseOption),
            typeof(RemoteDataArchiveAlterTableOption),
            typeof(RemoteDataArchiveDatabaseOption),
            typeof(RemoteDataArchiveDatabaseSetting),
            typeof(RemoteDataArchiveDbCredentialSetting),
            typeof(RemoteDataArchiveDbFederatedServiceAccountSetting),
            typeof(RemoteDataArchiveDbServerSetting),
            typeof(RemoteDataArchiveTableOption),
            typeof(RemoteServiceBindingOption),
            typeof(RemoteServiceBindingStatementBase),
            typeof(RenameAlterRoleAction),
            typeof(ResampleStatisticsOption),
            typeof(ResourcePoolAffinitySpecification),
            typeof(ResourcePoolParameter),
            typeof(ResourcePoolStatement),
            typeof(RestoreMasterKeyStatement),
            typeof(RestoreOption),
            typeof(RestoreServiceMasterKeyStatement),
            typeof(RestoreStatement),
            typeof(ResultColumnDefinition),
            typeof(ResultSetDefinition),
            typeof(ResultSetsExecuteOption),
            typeof(ReturnStatement),
            typeof(RevertStatement),
            typeof(RevokeStatement),
            typeof(RevokeStatement80),
            typeof(RightFunctionCall),
            typeof(RolePayloadOption),
            typeof(RoleStatement),
            typeof(RollbackTransactionStatement),
            typeof(RollupGroupingSpecification),
            typeof(RouteOption),
            typeof(RouteStatement),
            typeof(RowValue),
            typeof(SaveTransactionStatement),
            typeof(ScalarExpression),
            typeof(ScalarExpressionDialogOption),
            typeof(ScalarExpressionRestoreOption),
            typeof(ScalarExpressionSequenceOption),
            typeof(ScalarExpressionSnippet),
            typeof(ScalarFunctionReturnType),
            typeof(ScalarSubquery),
            typeof(SchemaDeclarationItem),
            typeof(SchemaDeclarationItemOpenjson),
            typeof(SchemaObjectFunctionTableReference),
            typeof(SchemaObjectName),
            typeof(SchemaObjectNameOrValueExpression),
            typeof(SchemaObjectNameSnippet),
            typeof(SchemaObjectResultSetDefinition),
            typeof(SchemaPayloadOption),
            typeof(SearchedCaseExpression),
            typeof(SearchedWhenClause),
            typeof(SearchPropertyListAction),
            typeof(SearchPropertyListFullTextIndexOption),
            typeof(SecondaryRoleReplicaOption),
            typeof(SecurityElement80),
            typeof(SecurityPolicyOption),
            typeof(SecurityPolicyStatement),
            typeof(SecurityPredicateAction),
            typeof(SecurityPrincipal),
            typeof(SecurityStatement),
            typeof(SecurityStatementBody80),
            typeof(SecurityTargetObject),
            typeof(SecurityTargetObjectName),
            typeof(SecurityUserClause80),
            typeof(SelectElement),
            typeof(SelectFunctionReturnType),
            typeof(SelectInsertSource),
            typeof(SelectiveXmlIndexPromotedPath),
            typeof(SelectScalarExpression),
            typeof(SelectSetVariable),
            typeof(SelectStarExpression),
            typeof(SelectStatement),
            typeof(SelectStatementSnippet),
            typeof(SemanticTableReference),
            typeof(SendStatement),
            typeof(SequenceOption),
            typeof(SequenceStatement),
            typeof(ServerAuditStatement),
            typeof(ServiceContract),
            typeof(SessionOption),
            typeof(SessionTimeoutPayloadOption),
            typeof(SetClause),
            typeof(SetCommand),
            typeof(SetCommandStatement),
            typeof(SetErrorLevelStatement),
            typeof(SetFipsFlaggerCommand),
            typeof(SetIdentityInsertStatement),
            typeof(SetOffsetsStatement),
            typeof(SetOnOffStatement),
            typeof(SetRowCountStatement),
            typeof(SetSearchPropertyListAlterFullTextIndexAction),
            typeof(SetStatisticsStatement),
            typeof(SetStopListAlterFullTextIndexAction),
            typeof(SetTextSizeStatement),
            typeof(SetTransactionIsolationLevelStatement),
            typeof(SetUserStatement),
            typeof(SetVariableStatement),
            typeof(ShutdownStatement),
            typeof(SignatureStatementBase),
            typeof(SimpleAlterFullTextIndexAction),
            typeof(SimpleCaseExpression),
            typeof(SimpleWhenClause),
            typeof(SizeFileDeclarationOption),
            typeof(SoapMethod),
            typeof(SourceDeclaration),
            typeof(SpatialIndexOption),
            typeof(SpatialIndexRegularOption),
            typeof(SqlCommandIdentifier),
            typeof(SqlDataTypeReference),
            typeof(StateAuditOption),
            typeof(StatementList),
            typeof(StatementListSnippet),
            typeof(StatementWithCtesAndXmlNamespaces),
            typeof(StatisticsOption),
            typeof(StatisticsPartitionRange),
            typeof(StopListFullTextIndexOption),
            typeof(StopRestoreOption),
            typeof(StringLiteral),
            typeof(SubqueryComparisonPredicate),
            typeof(SymmetricKeyStatement),
            typeof(SystemTimePeriodDefinition),
            typeof(SystemVersioningTableOption),
            typeof(TableDataCompressionOption),
            typeof(TableDefinition),
            typeof(TableHint),
            typeof(TableHintsOptimizerHint),
            typeof(TableOption),
            typeof(TableReference),
            typeof(TableReferenceWithAlias),
            typeof(TableReferenceWithAliasAndColumns),
            typeof(TableSampleClause),
            typeof(TableSwitchOption),
            typeof(TableValuedFunctionReturnType),
            typeof(TargetDeclaration),
            typeof(TargetRecoveryTimeDatabaseOption),
            typeof(TemporalClause),
            typeof(TextModificationStatement),
            typeof(ThrowStatement),
            typeof(TopRowFilter),
            typeof(TransactionStatement),
            typeof(TriggerAction),
            typeof(TriggerObject),
            typeof(TriggerOption),
            typeof(TriggerStatementBody),
            typeof(TruncateTableStatement),
            typeof(TryCastCall),
            typeof(TryCatchStatement),
            typeof(TryConvertCall),
            typeof(TryParseCall),
            typeof(TSEqualCall),
            typeof(TSqlBatch),
            typeof(TSqlFragment),  // this is not useful.
            typeof(TSqlFragmentSnippet),
            typeof(TSqlScript),
            typeof(TSqlStatement),
            typeof(TSqlStatementSnippet),
            typeof(UnaryExpression),
            typeof(UniqueConstraintDefinition),
            typeof(UnpivotedTableReference),
            typeof(UnqualifiedJoin),
            typeof(UpdateCall),
            typeof(UpdateDeleteSpecificationBase),
            typeof(UpdateForClause),
            typeof(UpdateMergeAction),
            typeof(UpdateSpecification),
            typeof(UpdateStatement),
            typeof(UpdateStatisticsStatement),
            typeof(UpdateTextStatement),
            typeof(UseFederationStatement),
            typeof(UserDataTypeReference),
            typeof(UserDefinedTypeCallTarget),
            typeof(UserDefinedTypePropertyAccess),
            typeof(UserLoginOption),
            typeof(UserRemoteServiceBindingOption),
            typeof(UserStatement),
            typeof(UseStatement),
            typeof(ValueExpression),
            typeof(ValuesInsertSource),
            typeof(VariableMethodCallTableReference),
            typeof(VariableReference),
            typeof(VariableTableReference),
            typeof(VariableValuePair),
            typeof(ViewOption),
            typeof(ViewStatementBody),
            typeof(WaitForStatement),
            typeof(WaitForSupportedStatement),
            typeof(WhenClause),
            typeof(WhereClause),
            typeof(WhileStatement),
            typeof(WindowDelimiter),
            typeof(WindowFrameClause),
            typeof(WindowsCreateLoginSource),
            typeof(WithCtesAndXmlNamespaces),
            typeof(WithinGroupClause),
            typeof(WitnessDatabaseOption),
            typeof(WorkloadGroupImportanceParameter),
            typeof(WorkloadGroupParameter),
            typeof(WorkloadGroupResourceParameter),
            typeof(WorkloadGroupStatement),
            typeof(WriteTextStatement),
            typeof(WsdlPayloadOption),
            typeof(XmlDataTypeReference),
            typeof(XmlForClause),
            typeof(XmlForClauseOption),
            typeof(XmlNamespaces),
            typeof(XmlNamespacesAliasElement),
            typeof(XmlNamespacesDefaultElement),
            typeof(XmlNamespacesElement),
        };
        */

        public SelectFragmentsForm()
        {
            InitializeComponent();

            fragmentTypes = RetrieveAllFragmentTypes();
        }

        public void SelectFragments(IWin32Window ownerForm, SqlFragmentTypeList selectedFragmentTypes)
        {
            InitListViewFragmentTypes(selectedFragmentTypes);

            if (ShowDialog(ownerForm) == DialogResult.OK)
            {
                selectedFragmentTypes.Clear();
                foreach (ListViewItem listViewItem in listViewFragmentTypes.Items)
                {
                    if (listViewItem.Checked)
                    {
                        selectedFragmentTypes.Add((Type)listViewItem.Tag);
                    }
                }
            }
        }

        private void InitListViewFragmentTypes(SqlFragmentTypeList selectedFragmentTypes)
        {
            listViewFragmentTypes.Items.Clear();
            foreach (var fragmentType in fragmentTypes)
            {
                ListViewItem item = new ListViewItem(fragmentType.Name);
                item.Checked = selectedFragmentTypes.Contains(fragmentType);
                item.Tag = fragmentType;
                listViewFragmentTypes.Items.Add(item);
            }
        }

        /// <summary>
        /// Find all visitor methods with 1 parameter of type or subtype of TSqlFragment.
        /// </summary>
        private static SqlFragmentTypeList RetrieveAllFragmentTypes()
        {
            var resultingTypes = new SqlFragmentTypeList();
            var visitorType = typeof(TSqlFragmentVisitor);
            var allMethods = visitorType.GetMethods();
            var visitMethods = allMethods.ToList().Where(aX => aX.Name == "Visit" || aX.Name == "ExplicitVisit");
            foreach (var method in visitMethods)
            {
                var parameters = method.GetParameters();
                if (parameters.Count() == 1 && typeof(TSqlFragment).IsAssignableFrom(parameters[0].ParameterType))
                {
                    var parameterType = parameters[0].ParameterType;
                    if (!resultingTypes.Contains(parameterType))
                    {
                        resultingTypes.Add(parameterType);
                    }
                }
            }
            return resultingTypes;
        }
    }
}
